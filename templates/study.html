<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>å‹‰å¼·è¿½åŠ  | Study Avatar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='base-style.css') }}">
    <style>
        /* ã‚¿ã‚¤ãƒãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .timer-box {
            background-color: #333;
            color: #0f0;
            font-family: 'Courier New', Courier, monospace;
            font-size: 2.5rem;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: inset 0 0 10px #000;
            letter-spacing: 2px;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        /* ãƒ‡ãƒãƒƒã‚°ã‚¨ãƒªã‚¢ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .debug-area {
            background-color: #f0f0f0;
            padding: 15px;
            margin-top: 30px;
            border: 2px dashed #bbb;
            border-radius: 8px;
        }
    </style>
</head>

<body>

    <header class="main-header">
        <h1>Study Avatar</h1>
        <nav>
            <ul>
                <li><a href="{{ url_for('index') }}">ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="{{ url_for('study.new_study') }}">å‹‰å¼·è¨˜éŒ²</a></li>
                <li><a href="{{ url_for('setting.seed_set') }}">è¨­å®š</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="record-grid">

            <div class="char-side card">
                <h2>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</h2>
                <div class="avatar-display-large">
                    {% if skin %}
                    <img src="{{ skin }}" alt="Current Avatar" class="avatar-img-large">
                    {% else %}
                    <div class="no-avatar-placeholder">
                        <p>No Image</p>
                    </div>
                    {% endif %}
                </div>
                <div class="char-message">
                    <p>ã€Œé›†ä¸­ã—ã¦é ‘å¼µã‚ã†ï¼ã€</p>
                </div>
            </div>

            <div class="form-side card">
                <h2>å‹‰å¼·æ™‚é–“ã‚’è¨˜éŒ²ã™ã‚‹</h2>

                <form action="{{ url_for('study.new_study') }}" method="post" class="study-form">

                    <!-- <div class="form-group">
                        <label>æ—¥ä»˜</label>
                        <input type="date" name="date" class="form-control">
                        <input type="hidden" name="start_date" id="start_date">
                        <input type="hidden" name="started" id="started" value="0">
                    </div> -->

                    <div class="form-group">
                        <label>æ•™ç§‘</label>
                        <select name="subject" class="form-control" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <optgroup label="ç†ç³»">
                                <option value="æ•°å­¦">æ•°å­¦</option>
                                <option value="ç‰©ç†">ç‰©ç†</option>
                                <option value="åŒ–å­¦">åŒ–å­¦</option>
                                <option value="ç”Ÿç‰©">ç”Ÿç‰©</option>
                                <option value="æƒ…å ±">æƒ…å ±</option>
                                <option value="ç†ç³»ãã®ä»–">ç†ç³»ãã®ä»–</option>
                            </optgroup>
                            <optgroup label="æ–‡ç³»">
                                <option value="å›½èª">å›½èª</option>
                                <option value="è‹±èª">è‹±èª</option>
                                <option value="æ—¥æœ¬å²">æ—¥æœ¬å²</option>
                                <option value="ä¸–ç•Œå²">ä¸–ç•Œå²</option>
                                <option value="åœ°ç†">åœ°ç†</option>
                                <option value="æ–‡ç³»ãã®ä»–">æ–‡ç³»ãã®ä»–</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input type="text" name="title" class="form-control" placeholder="ä¾‹: ä¸­é–“ãƒ†ã‚¹ãƒˆå¯¾ç­–" required>
                    </div>

                    <div class="form-group">
                        <label>ã‚¿ã‚¤ãƒ è¨ˆæ¸¬</label>
                        <div class="timer-box">
                            <span id="timer_minutes">00</span> : <span id="timer_seconds">00</span>
                        </div>
                        <div class="timer-controls">
                            <button type="button" class="btn-primary" onclick="startTimer()"
                                style="background-color: #2196F3;">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                            <button type="button" class="btn-primary" onclick="stopTimer()"
                                style="background-color: #F44336;">ã‚¹ãƒˆãƒƒãƒ—</button>
                        </div>
                    </div>

                    <!-- <div class="form-group">
                        <label>æ™‚é–“ (åˆ†)</label>
                        <input type="number" name="minutes" id="minutes" class="form-control" placeholder="60" required>
                    </div> -->

                    <div class="form-group">
                        <label>å‚™è€ƒ</label>
                        <textarea name="note" rows="3" class="form-control" placeholder="æ„Ÿæƒ³ãªã©"></textarea>
                    </div>

                    <div class="form-actions" style="display: flex; gap: 10px;">
                        <button type="submit" class="btn-primary">è¨˜éŒ²å®Œäº†</button>
                        <button type="button" class="btn-small" onclick="location.href='{{ url_for('index') }}'"
                            style="background: #ccc; border:none; color: #333; width: auto; padding: 12px 20px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>

                    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">
                    <h3>æœ€è¿‘ã®è¨˜éŒ²ãƒªã‚¹ãƒˆ</h3>
                    <div class="table-wrapper" style="max-height: 200px; margin-bottom: 20px;">
                        <table class="log-table">
                            <thead>
                                <tr>
                                    <th>æ—¥ä»˜</th>
                                    <th>æ•™ç§‘</th>
                                    <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
                                    <th>æ™‚é–“</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for study in items %}
                                <tr>
                                    <td>{{ study.date }}</td>
                                    <td>{{ study.subject }}</td>
                                    <td>{{ study.title }}</td>
                                    <td>{{ study.minutes }}åˆ†</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    {% if debug %}
                    <div class="debug-area">
                        <h4 style="margin-top: 0; color: #555;">ğŸ”§ ãƒ‡ãƒãƒƒã‚°ç”¨æ‰‹å…¥åŠ›</h4>
                        <div class="form-group">
                            <label>æ—¥ä»˜ (æ‰‹å‹•): <input type="date" name="debug_date" class="form-control"></label>
                        </div>
                        <div class="form-group">
                            <label>æ™‚é–“ (åˆ†ãƒ»æ‰‹å‹•): <input type="number" name="debug_minutes" min="0"
                                    class="form-control"></label>
                        </div>
                        <p style="color: gray; font-size: 0.8rem;">â€»ã‚¿ã‚¤ãƒãƒ¼ã‚’ä½¿ã‚ãšã€å¼·åˆ¶çš„ã«æ—¥æ™‚ã‚’æŒ‡å®šã—ã¦è¨˜éŒ²ã™ã‚‹å ´åˆã«ä½¿ç”¨ï¼ˆä¸Šã®ç™»éŒ²ãƒœã‚¿ãƒ³ã§é€ä¿¡ã•ã‚Œã¾ã™ï¼‰</p>
                    </div>
                    {% endif %}

                </form>
            </div>
        </div>
    </div>


    <script>
        let startTime = null;
        let timerInterval = null;

        function startTimer() {
            if (timerInterval !== null) return;
            startTime = Date.now();

            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');

            const dateField = document.getElementById("start_date");
            if (dateField) dateField.value = `${yyyy}-${mm}-${dd}`;

            const startedField = document.getElementById("started");
            if (startedField) startedField.value = "1";

            timerInterval = setInterval(() => {
                const diffMs = Date.now() - startTime;
                const minutes = Math.floor(diffMs / 60000);
                const seconds = Math.floor((diffMs % 60000) / 1000);

                document.getElementById("timer_minutes").textContent = String(minutes).padStart(2, "0");
                document.getElementById("timer_seconds").textContent = String(seconds).padStart(2, "0");

                const minutesInput = document.getElementById("minutes");
                if (minutesInput) {
                    minutesInput.value = minutes;
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval !== null) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
    </script>

</body>

</html>