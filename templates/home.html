<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ホーム | Study Avatar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='base-style.css') }}">
</head>
<body>

    <header class="main-header">
        <h1>Study Avatar</h1>
        <nav>
            <ul>
                <li><a href="{{ url_for('home') }}" class="active">ホーム</a></li>
                <li><a href="{{ url_for('study.new_study') }}">勉強記録</a></li>
                <li><a href="{{ url_for('setting.seed_set') }}">設定</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="dashboard-grid">
            

            <div class="current-char-area card">
                <h2>今日のパートナー</h2>

                <div class="avatar-display-large">
                    {% if skin %}
                        <img src="{{ skin }}" alt="Current Avatar" class="avatar-img-large">
                    {% else %}
                        <div class="no-avatar-placeholder">
                            <p>No Image</p>
                        </div>
                    {% endif %}
                </div>

                <div class="progress-container" style="width: 85%; margin: 15px auto;">
                    <iframe src="{{ url_for('progress.show_bars') }}" 
                            style="width: 100%; height: 190px; border: none; overflow: hidden;">
                    </iframe>
                </div>

                <div class="char-info">
                    <p class="today-date">{{ current_date }}</p>

                    <form action="{{ url_for('avatar.update_today_avatar') }}" method="post">
                        <button type="submit" class="btn-update">今日の成長を反映</button>
                    </form>
                </div>
            </div>

            <div class="history-area card">
                <h3>過去のキャラ</h3>
                <div class="history-scroller">
                    <div class="history-list">
                        {% for n in range(7) %}
                        <div class="history-item">
                            <div class="history-avatar-wrapper">
                                <img src="{{ avatar_skin_days_ago(n) }}" alt="{{ n }}日前" class="avatar-img-small">
                            </div>
                            <span class="history-label">
                                {% if n == 0 %}今日
                                {% elif n == 1 %}昨日
                                {% else %}{{ n }}日前
                                {% endif %}
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="graph-area card">
                <h3>学習統計</h3>
                <div class="chart-container" style="flex: 1; min-height: 200px;">
                    <iframe src="{{ url_for('stats.study_transition') }}" style="width: 100%; height: 100%; border: none; overflow: hidden;"></iframe>
                </div>
            </div>

            <div class="log-area card">
                <div class="log-header">
                    <h3>学習ログ</h3>
                    <a href="{{ url_for('study.new_study') }}" class="btn-small">記録追加</a>
                </div>

                <div class="table-wrapper">
                    <table class="log-table">
                        <thead>
                            <tr>
                                <th>日付</th>
                                <th>教科</th>
                                <th>タイトル</th>
                                <th>時間</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if recent_studies %}
                                {% for study in recent_studies %}
                                <tr>
                                    <td>{{ study.date }}</td>
                                    <td>{{ study.subject }}</td>
                                    <td>{{ study.title }}</td>
                                    <td>{{ study.minutes }}分</td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 20px; color: #999;">
                                        まだ記録がありません
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

</body>
</html>